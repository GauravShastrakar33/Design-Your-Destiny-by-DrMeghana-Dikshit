### Admin Panelâ€¨### User Management â€¨### Students
ðŸš€ FULL STUDENT MANAGEMENT (ADMIN PANEL) 

âœ… STEP 1 â€” Create Extra Tables (programs + user_program)
Create/modify server/db/schema.ts and add:

import { pgTable, serial, varchar, integer } from "drizzle-orm/pg-core";
import { timestamp } from "drizzle-orm/pg-core";

export const programs = pgTable("programs", {
  id: serial("id").primaryKey(),
  code: varchar("code", { length: 10 }).notNull().unique(),  // DYD, USM, USC, USB
  name: varchar("name", { length: 150 }).notNull(),
});

export const userProgram = pgTable("user_program", {
  id: serial("id").primaryKey(),
  userId: integer("user_id").notNull(),
  programId: integer("program_id").notNull(),
});
Seed programs table (once):

INSERT INTO programs (code, name) VALUES
('DYD', 'Design Your Destiny'),
('USM', 'Ultimate Success Mastery'),
('USC', 'Ultimate Success Champion'),
('USB', 'Ultimate Success Builder');
Run:

npm run db:push

âœ… STEP 2 â€” Backend Routes for Student Management
Create file:
ðŸ“Œ server/routes/admin/students.ts
Paste:

import { Router } from "express";
import { db } from "../../db";
import { users, userProgram, programs } from "../../db/schema";
import { eq, ilike, and } from "drizzle-orm";
import bcrypt from "bcryptjs";

const router = Router();

// --------------------------------------
// GET /admin/v1/students (list + search + filter + pagination)
// --------------------------------------
router.get("/", async (req, res) => {
  try {
    const search = req.query.search || "";
    const program = req.query.program || "ALL";
    const page = Number(req.query.page) || 1;
    const limit = Number(req.query.limit) || 20;
    const offset = (page - 1) * limit;

    // Base where conditions
    let whereConditions = [];

    if (search) {
      whereConditions.push(
        ilike(users.name, `%${search}%`)
      );
    }

    // Filter by program (if not ALL)
    let programFilterUserIds = null;

    if (program !== "ALL") {
      const programRow = await db.select().from(programs).where(eq(programs.code, program)).limit(1);
      if (programRow.length) {
        const programId = programRow[0].id;
        const userRows = await db.select().from(userProgram).where(eq(userProgram.programId, programId));
        programFilterUserIds = userRows.map(u => u.userId);
      }
    }

    const finalWhere = [];

    if (whereConditions.length) finalWhere.push(...whereConditions);

    if (programFilterUserIds) {
      if (programFilterUserIds.length > 0) {
        finalWhere.push(eq(users.id, programFilterUserIds));
      } else {
        return res.json({ data: [], pagination: { total: 0, page: 1, pages: 1 } });
      }
    }

    const data = await db.select().from(users).where(and(...finalWhere)).limit(limit).offset(offset);

    // Fetch programs for each user
    for (const s of data) {
      const links = await db.select().from(userProgram).where(eq(userProgram.userId, s.id));
      const programIds = links.map(l => l.programId);

      const programRows = await db
        .select()
        .from(programs)
        .where(eq(programs.id, programIds));

      s.programs = programRows.map(p => p.code);
    }

    const total = await db.select().from(users);

    return res.json({
      data,
      pagination: {
        total: total.length,
        page,
        pages: Math.ceil(total.length / limit)
      }
    });

  } catch (err) {
    console.error(err);
    res.status(500).json({ error: "Failed to load students" });
  }
});

// --------------------------------------
// POST /admin/v1/students (add)
// --------------------------------------
router.post("/", async (req, res) => {
  try {
    const { name, email, phone, password, programCode } = req.body;

    if (!name || !email || !programCode)
      return res.status(400).json({ error: "Missing required fields" });

    const hashed = await bcrypt.hash(password || "User@123", 10);

    const created = await db
      .insert(users)
      .values({
        name,
        email,
        phone: phone || null,
        passwordHash: hashed,
        role: "USER",
        status: "active"
      })
      .returning();

    const userId = created[0].id;

    const programRow = await db
      .select()
      .from(programs)
      .where(eq(programs.code, programCode));

    await db.insert(userProgram).values({
      userId,
      programId: programRow[0].id
    });

    res.json({ message: "Student added", userId });

  } catch (err) {
    console.error("Add Student Error:", err);
    res.status(500).json({ error: "Failed to add student" });
  }
});

// --------------------------------------
// PUT /admin/v1/students/:id (edit)
// --------------------------------------
router.put("/:id", async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { name, email, phone, status, programCode } = req.body;

    await db.update(users).set({ name, email, phone, status }).where(eq(users.id, id));

    if (programCode) {
      await db.delete(userProgram).where(eq(userProgram.userId, id));

      const programRow = await db.select().from(programs).where(eq(programs.code, programCode));
      await db.insert(userProgram).values({
        userId: id,
        programId: programRow[0].id
      });
    }

    res.json({ message: "Student updated" });

  } catch (err) {
    res.status(500).json({ error: "Failed to update student" });
  }
});

// --------------------------------------
// PATCH /admin/v1/students/:id/status (block/unblock)
// --------------------------------------
router.patch("/:id/status", async (req, res) => {
  try {
    const id = Number(req.params.id);
    const { status } = req.body;

    await db.update(users).set({ status }).where(eq(users.id, id));

    res.json({ message: "Status updated" });

  } catch (err) {
    res.status(500).json({ error: "Failed to update status" });
  }
});

// --------------------------------------
// DELETE /admin/v1/students/:id
// --------------------------------------
router.delete("/:id", async (req, res) => {
  try {
    const id = Number(req.params.id);

    await db.delete(userProgram).where(eq(userProgram.userId, id));
    await db.delete(users).where(eq(users.id, id));

    res.json({ message: "Student deleted" });

  } catch (err) {
    res.status(500).json({ error: "Failed to delete student" });
  }
});

export default router;
Register route inside server/index.ts:

app.use("/admin/v1/students", authenticate, studentsRoute);

âœ… STEP 3 â€” FRONTEND Student Dashboard UI
Create file:
ðŸ“Œ src/pages/admin/Students.tsx
Paste:

import { useEffect, useState } from "react";
import { MoreVertical } from "lucide-react";
import axios from "../../utils/axiosInstance";
import { useNavigate } from "react-router-dom";

export default function Students() {
  const [students, setStudents] = useState([]);
  const [search, setSearch] = useState("");
  const [program, setProgram] = useState("ALL");
  const [loading, setLoading] = useState(true);

  const [total, setTotal] = useState(0);
  const [page, setPage] = useState(1);
  const [pages, setPages] = useState(1);

  const navigate = useNavigate();

  useEffect(() => {
    fetchStudents();
  }, [search, program, page]);

  async function fetchStudents() {
    setLoading(true);

    const token = localStorage.getItem("admin_token");

    const res = await axios.get("/admin/v1/students", {
      headers: { Authorization: `Bearer ${token}` },
      params: { search, program, page, limit: 20 }
    });

    setStudents(res.data.data);
    setTotal(res.data.pagination.total);
    setPages(res.data.pagination.pages);
    setLoading(false);
  }

  function formatDate(d) {
    if (!d) return "-";
    return new Date(d).toLocaleDateString();
  }

  return (
    <div className="p-6 space-y-6">
      
      {/* HEADER */}
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-semibold">Students</h1>

        <button
          onClick={() => console.log("open add student modal")}
          className="px-4 py-2 rounded"
        >
          + Add Student
        </button>
      </div>

      {/* SEARCH + FILTER */}
      <div className="flex gap-4 items-center">
        <input
          className="border px-3 py-2 rounded w-64"
          placeholder="Search by name/email"
          value={search}
          onChange={(e) => setSearch(e.target.value)}
        />

        <select
          value={program}
          onChange={(e) => setProgram(e.target.value)}
          className="border px-3 py-2 rounded"
        >
          <option value="ALL">All Programs</option>
          <option value="DYD">DYD</option>
          <option value="USM">USM</option>
          <option value="USC">USC</option>
          <option value="USB">USB</option>
        </select>

        <button
          onClick={fetchStudents}
          className="px-4 py-2 rounded"
        >
          Search
        </button>
      </div>

      {/* TABLE */}
      <div className="rounded shadow overflow-hidden">
        <table className="w-full border-collapse">
          <thead>
            <tr className="text-left">
              <th className="p-3">Name</th>
              <th className="p-3">Email</th>
              <th className="p-3">Phone</th>
              <th className="p-3">Status</th>
              <th className="p-3">Last Login</th>
              <th className="p-3">Last Activity</th>
              <th className="p-3">Created At</th>
              <th className="p-3"></th>
            </tr>
          </thead>

          <tbody>
            {loading ? (
              <tr><td className="p-3">Loading...</td></tr>
            ) : (
              students.map((s) => (
                <tr key={s.id} className="border-b">
                  
                  <td 
                    className="p-3 cursor-pointer"
                    onClick={() => navigate(`/admin/students/${s.id}`)}
                  >
                    {s.name}
                  </td>

                  <td className="p-3">{s.email}</td>
                  <td className="p-3">{s.phone || "-"}</td>
                  <td className="p-3">{s.status}</td>
                  <td className="p-3">{formatDate(s.lastLogin)}</td>
                  <td className="p-3">{formatDate(s.lastActivity)}</td>
                  <td className="p-3">{formatDate(s.createdAt)}</td>

                  <td className="p-3 text-right">
                    <button onClick={() => console.log("actions", s.id)}>
                      <MoreVertical size={18} />
                    </button>
                  </td>

                </tr>
              ))
            )}
          </tbody>
        </table>
      </div>

      {/* Pagination */}
      <div className="flex justify-between items-center">
        <p>
          Showing {(page - 1) * 20 + 1}-{Math.min(page * 20, total)} of {total}
        </p>

        <p>
          Page {page} of {pages}
        </p>
      </div>
    </div>
  );
}â€¨â€¨use colours as per the app theme 



ðŸŽ‰ YOU NOW HAVE FULL STUDENT MANAGEMENT BUILT
âœ” List Studentsâ€¨âœ” Searchâ€¨âœ” Filter by programâ€¨âœ” Paginationâ€¨âœ” Add Studentâ€¨âœ” Edit Studentâ€¨âœ” Block/Unblockâ€¨âœ” Deleteâ€¨âœ” View Student Details (linked)â€¨âœ” Program assignment manualâ€¨âœ” Backend + Database complete