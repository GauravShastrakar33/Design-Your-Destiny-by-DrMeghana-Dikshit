Implement In-App Notifications (Inbox)
Context

Backend: Node.js + Express

Database: PostgreSQL

Auth: JWT (req.user.sub is user ID)

Push notifications (FCM) already implemented

Deep links from notifications already implemented

Existing tables:

notifications

notification_logs

device_tokens

UI already has a Notifications screen (bell icon)

‚ö†Ô∏è IMPORTANT

This is in-app notifications only

Do NOT add new tables unless absolutely required

Reuse existing notification data

Do NOT change push logic

üéØ Goal

Show all notifications inside the app, even if:

Push was missed

User opens app later

App was closed when notification arrived

The Notifications screen should act as a persistent inbox.

üß± Database Usage (NO new tables)
notifications

Source of truth for notification content

notification_logs

Used to determine:

Which user received which notification

Delivery time

Status

üîå API to Implement
1Ô∏è‚É£ Fetch in-app notifications for logged-in user

Endpoint

GET /api/v1/notifications


Auth

Requires JWT

Logic

Get userId = req.user.sub

Join:

notification_logs

notifications

Filter:

notification_logs.user_id = userId

Order by:

notification_logs.created_at DESC

Response example

[
  {
    "id": 12,
    "title": "Inner Circle Masterclass Tomorrow",
    "body": "Your Inner Circle Masterclass starts tomorrow at 7:00 PM",
    "type": "event",
    "relatedEventId": 42,
    "createdAt": "2025-01-02T14:30:00Z"
  }
]

üß≠ Frontend Integration
2Ô∏è‚É£ Populate Notifications screen

Call GET /api/v1/notifications

Display list using existing UI

Show:

Title

Body

Relative time (e.g. ‚Äú2 hours ago‚Äù)

3Ô∏è‚É£ Click behavior (reuse deep links)

When user taps a notification:

If relatedEventId exists ‚Üí navigate to /events/{id}

Else ‚Üí navigate to home /

‚ö†Ô∏è Do NOT add new routing logic ‚Äî reuse existing deep-link behavior

üîî Bell Icon (optional but recommended)

Show count = number of notifications returned

No unread logic yet (future phase)

üö´ Do NOT Implement (for now)

‚ùå Read/unread status

‚ùå Mark as read API

‚ùå Notification preferences

‚ùå New notification tables

‚ùå Android/iOS native UI changes

‚úÖ Acceptance Criteria

Notifications sent via push also appear in app inbox

Users see notifications even if push was missed

Event notifications deep-link correctly from inbox

Notifications are scoped per user

No duplicate notifications shown

Uses existing tables only

üß† Result After This

You will have:

Push notifications ‚úÖ

Deep links ‚úÖ

In-app inbox ‚úÖ

This completes Phase 1 (Web Notifications).